import os
import pandas as pd

from ram import config

import matplotlib.pyplot as plt

from ram.analysis.run_manager import RunManager
from ram.analysis.run_aggregator import RunAggregator

# View all available strategies
print RunManager.get_strategies()


print RunManager.get_run_names('StatArbStrategy')

rm1 = RunManager('StatArbStrategy', 'run_0021', 2009)
rm2 = RunManager('StatArbStrategy', 'run_0022', 2009)
rm3 = RunManager('StatArbStrategy', 'run_0023', 2009)


rm1.import_return_frame()
rm2.import_return_frame()
rm3.import_return_frame()



plt.figure()
plt.plot(rm1.returns.cumsum(), 'b', alpha=.5)
plt.plot(rm2.returns.cumsum(), 'g', alpha=.5)
plt.plot(rm3.returns.cumsum(), 'r', alpha=.5)
plt.show()



rm1.analyze_parameters()
rm2.analyze_parameters()
rm3.analyze_parameters()






# Take
# 0.10
x1 = [u'100', u'101', u'102', u'103', u'104', u'105', u'106', u'107', u'108', u'109', u'110', u'111', u'112', u'113', u'114', u'115', u'116', u'117', u'118', u'119', u'120', u'121', u'122', u'123', u'124', u'125', u'126', u'127', u'160', u'161', u'162', u'163', u'164', u'165', u'166', u'167', u'168', u'169', u'170', u'171', u'172', u'173', u'174', u'175', u'176', u'177', u'178', u'179', u'180', u'181', u'182', u'183', u'184', u'185', u'186', u'187', u'188', u'189', u'190', u'191', u'224', u'225', u'226', u'227', u'228', u'229', u'230', u'231', u'232', u'233', u'234', u'235', u'236', u'237', u'238', u'239', u'240', u'241', u'242', u'243', u'244', u'245', u'246', u'247', u'248', u'249', u'250', u'251', u'252', u'253', u'254', u'255', u'288', u'289', u'290', u'291', u'292', u'293', u'294', u'295', u'296', u'297', u'298', u'299', u'300', u'301', u'302', u'303', u'304', u'305', u'306', u'307', u'308', u'309', u'310', u'311', u'312', u'313', u'314', u'315', u'316', u'317', u'318', u'319', u'32', u'33', u'34', u'35', u'352', u'353', u'354', u'355', u'356', u'357', u'358', u'359', u'36', u'360', u'361', u'362', u'363', u'364', u'365', u'366', u'367', u'368', u'369', u'37', u'370', u'371', u'372', u'373', u'374', u'375', u'376', u'377', u'378', u'379', u'38', u'380', u'381', u'382', u'383', u'39', u'40', u'41', u'416', u'417', u'418', u'419', u'42', u'420', u'421', u'422', u'423', u'424', u'425', u'426', u'427', u'428', u'429', u'43', u'430', u'431', u'432', u'433', u'434', u'435', u'436', u'437', u'438', u'439', u'44', u'440', u'441', u'442', u'443', u'444', u'445', u'446', u'447', u'45', u'46', u'47', u'48', u'480', u'481', u'482', u'483', u'484', u'485', u'486', u'487', u'488', u'489', u'49', u'490', u'491', u'492', u'493', u'494', u'495', u'496', u'497', u'498', u'499', u'50', u'500', u'501', u'502', u'503', u'504', u'505', u'506', u'507', u'508', u'509', u'51', u'510', u'511', u'52', u'53', u'54', u'55', u'56', u'57', u'58', u'59', u'60', u'61', u'62', u'63', u'96', u'97', u'98', u'99']
# 0.03
x2 = [u'0', u'1', u'10', u'11', u'12', u'128', u'129', u'13', u'130', u'131', u'132', u'133', u'134', u'135', u'136', u'137', u'138', u'139', u'14', u'140', u'141', u'142', u'143', u'144', u'145', u'146', u'147', u'148', u'149', u'15', u'150', u'151', u'152', u'153', u'154', u'155', u'156', u'157', u'158', u'159', u'16', u'17', u'18', u'19', u'192', u'193', u'194', u'195', u'196', u'197', u'198', u'199', u'2', u'20', u'200', u'201', u'202', u'203', u'204', u'205', u'206', u'207', u'208', u'209', u'21', u'210', u'211', u'212', u'213', u'214', u'215', u'216', u'217', u'218', u'219', u'22', u'220', u'221', u'222', u'223', u'23', u'24', u'25', u'256', u'257', u'258', u'259', u'26', u'260', u'261', u'262', u'263', u'264', u'265', u'266', u'267', u'268', u'269', u'27', u'270', u'271', u'272', u'273', u'274', u'275', u'276', u'277', u'278', u'279', u'28', u'280', u'281', u'282', u'283', u'284', u'285', u'286', u'287', u'29', u'3', u'30', u'31', u'320', u'321', u'322', u'323', u'324', u'325', u'326', u'327', u'328', u'329', u'330', u'331', u'332', u'333', u'334', u'335', u'336', u'337', u'338', u'339', u'340', u'341', u'342', u'343', u'344', u'345', u'346', u'347', u'348', u'349', u'350', u'351', u'384', u'385', u'386', u'387', u'388', u'389', u'390', u'391', u'392', u'393', u'394', u'395', u'396', u'397', u'398', u'399', u'4', u'400', u'401', u'402', u'403', u'404', u'405', u'406', u'407', u'408', u'409', u'410', u'411', u'412', u'413', u'414', u'415', u'448', u'449', u'450', u'451', u'452', u'453', u'454', u'455', u'456', u'457', u'458', u'459', u'460', u'461', u'462', u'463', u'464', u'465', u'466', u'467', u'468', u'469', u'470', u'471', u'472', u'473', u'474', u'475', u'476', u'477', u'478', u'479', u'5', u'6', u'64', u'65', u'66', u'67', u'68', u'69', u'7', u'70', u'71', u'72', u'73', u'74', u'75', u'76', u'77', u'78', u'79', u'8', u'80', u'81', u'82', u'83', u'84', u'85', u'86', u'87', u'88', u'89', u'9', u'90', u'91', u'92', u'93', u'94', u'95']

# Stops
# -0.03
x3 = [u'0', u'10', u'100', u'102', u'104', u'106', u'108', u'110', u'112', u'114', u'116', u'118', u'12', u'120', u'122', u'124', u'126', u'128', u'130', u'132', u'134', u'136', u'138', u'14', u'140', u'142', u'144', u'146', u'148', u'150', u'152', u'154', u'156', u'158', u'16', u'160', u'162', u'164', u'166', u'168', u'170', u'172', u'174', u'176', u'178', u'18', u'180', u'182', u'184', u'186', u'188', u'190', u'192', u'194', u'196', u'198', u'2', u'20', u'200', u'202', u'204', u'206', u'208', u'210', u'212', u'214', u'216', u'218', u'22', u'220', u'222', u'224', u'226', u'228', u'230', u'232', u'234', u'236', u'238', u'24', u'240', u'242', u'244', u'246', u'248', u'250', u'252', u'254', u'256', u'258', u'26', u'260', u'262', u'264', u'266', u'268', u'270', u'272', u'274', u'276', u'278', u'28', u'280', u'282', u'284', u'286', u'288', u'290', u'292', u'294', u'296', u'298', u'30', u'300', u'302', u'304', u'306', u'308', u'310', u'312', u'314', u'316', u'318', u'32', u'320', u'322', u'324', u'326', u'328', u'330', u'332', u'334', u'336', u'338', u'34', u'340', u'342', u'344', u'346', u'348', u'350', u'352', u'354', u'356', u'358', u'36', u'360', u'362', u'364', u'366', u'368', u'370', u'372', u'374', u'376', u'378', u'38', u'380', u'382', u'384', u'386', u'388', u'390', u'392', u'394', u'396', u'398', u'4', u'40', u'400', u'402', u'404', u'406', u'408', u'410', u'412', u'414', u'416', u'418', u'42', u'420', u'422', u'424', u'426', u'428', u'430', u'432', u'434', u'436', u'438', u'44', u'440', u'442', u'444', u'446', u'448', u'450', u'452', u'454', u'456', u'458', u'46', u'460', u'462', u'464', u'466', u'468', u'470', u'472', u'474', u'476', u'478', u'48', u'480', u'482', u'484', u'486', u'488', u'490', u'492', u'494', u'496', u'498', u'50', u'500', u'502', u'504', u'506', u'508', u'510', u'52', u'54', u'56', u'58', u'6', u'60', u'62', u'64', u'66', u'68', u'70', u'72', u'74', u'76', u'78', u'8', u'80', u'82', u'84', u'86', u'88', u'90', u'92', u'94', u'96', u'98']
# -0.10
x4 = [u'1', u'101', u'103', u'105', u'107', u'109', u'11', u'111', u'113', u'115', u'117', u'119', u'121', u'123', u'125', u'127', u'129', u'13', u'131', u'133', u'135', u'137', u'139', u'141', u'143', u'145', u'147', u'149', u'15', u'151', u'153', u'155', u'157', u'159', u'161', u'163', u'165', u'167', u'169', u'17', u'171', u'173', u'175', u'177', u'179', u'181', u'183', u'185', u'187', u'189', u'19', u'191', u'193', u'195', u'197', u'199', u'201', u'203', u'205', u'207', u'209', u'21', u'211', u'213', u'215', u'217', u'219', u'221', u'223', u'225', u'227', u'229', u'23', u'231', u'233', u'235', u'237', u'239', u'241', u'243', u'245', u'247', u'249', u'25', u'251', u'253', u'255', u'257', u'259', u'261', u'263', u'265', u'267', u'269', u'27', u'271', u'273', u'275', u'277', u'279', u'281', u'283', u'285', u'287', u'289', u'29', u'291', u'293', u'295', u'297', u'299', u'3', u'301', u'303', u'305', u'307', u'309', u'31', u'311', u'313', u'315', u'317', u'319', u'321', u'323', u'325', u'327', u'329', u'33', u'331', u'333', u'335', u'337', u'339', u'341', u'343', u'345', u'347', u'349', u'35', u'351', u'353', u'355', u'357', u'359', u'361', u'363', u'365', u'367', u'369', u'37', u'371', u'373', u'375', u'377', u'379', u'381', u'383', u'385', u'387', u'389', u'39', u'391', u'393', u'395', u'397', u'399', u'401', u'403', u'405', u'407', u'409', u'41', u'411', u'413', u'415', u'417', u'419', u'421', u'423', u'425', u'427', u'429', u'43', u'431', u'433', u'435', u'437', u'439', u'441', u'443', u'445', u'447', u'449', u'45', u'451', u'453', u'455', u'457', u'459', u'461', u'463', u'465', u'467', u'469', u'47', u'471', u'473', u'475', u'477', u'479', u'481', u'483', u'485', u'487', u'489', u'49', u'491', u'493', u'495', u'497', u'499', u'5', u'501', u'503', u'505', u'507', u'509', u'51', u'511', u'53', u'55', u'57', u'59', u'61', u'63', u'65', u'67', u'69', u'7', u'71', u'73', u'75', u'77', u'79', u'81', u'83', u'85', u'87', u'89', u'9', u'91', u'93', u'95', u'97', u'99']



rets1 = rm3.returns.loc[:, set(x1).intersection(x3)]
rets2 = rm3.returns.loc[:, set(x1).intersection(x4)]
rets3 = rm3.returns.loc[:, set(x2).intersection(x3)]
rets4 = rm3.returns.loc[:, set(x2).intersection(x4)]



plt.figure()
plt.plot(rets2.cumsum(), 'g', alpha=.5)
plt.plot(rets4.cumsum(), 'g', alpha=.5)
plt.plot(rets1.cumsum(), 'b', alpha=.5)
plt.plot(rets3.cumsum(), 'b', alpha=.5)
plt.show()





print rets1.mean().mean()
print rets2.mean().mean()


# ~~~~~~ RunAggregator ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ra = RunAggregator()

ra.add_run(rm1)
ra.add_run(rm2)

returns = ra.aggregate_returns()





plt.figure()
plt.plot(comb.best_results_rets.fillna(0).cumsum())
plt.show()









